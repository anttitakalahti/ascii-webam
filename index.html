<!DOCTYPE HTML>
<html>
    <head>
        <script>

            navigator.getMedia = ( navigator.getUserMedia ||
                                   navigator.webkitGetUserMedia ||
                                   navigator.mozGetUserMedia ||
                                   navigator.msGetUserMedia)
            navigator.getMedia (
                {
      	            video: true,
                    audio: false
                },

                function(localMediaStream) {
                    var video = document.querySelector('video');
                    video.src = window.URL.createObjectURL(localMediaStream);
                    video.onloadedmetadata = function(e) {
                        captureImage()
                    }
                },

                function(err) { console.log("The following error occured: " + err) }
            )

            function captureImage() {
                var video = document.querySelector('video')
                if (!video) { return }
		
                var canvas = document.querySelector('canvas')
        
                canvas.width = video.videoWidth
                canvas.height = video.videoHeight

                var context = canvas.getContext('2d')
                context.drawImage(video, 0, 0, canvas.width, canvas.height)

                var idata = context.getImageData(0,0,640,480)
                var data = idata.data
		
                document.getElementById('output').innerHTML = getString(data, 640, 480)
            }

	    var chars = ['@','#','$','A',
			 '*','H','x','z',
			 'o','+','=','-', 
			 ':',',','.',' ']

            function getString(data, width, height) {
                var next = 0
                var string = ''

                // data[0] = red
                // data[1] = green
                // data[2] = blue
                // data[3] = alpha

                for (var row = 0; row < height; row++) {
                    if (row % 5 != 0) {
                        next += 4 * width
                        continue
                    }
		    var line = ''
                    for (var col = 0; col < width; col++) {
                        if (col % 2 == 0) {
                            var color = data[next] + data[next + 1] + data[next + 2]
                            color = color / 3
                            line = chars[parseInt(color / 16)] + line
                        }
                        next = next + 4
                    }
                    string = string + line + '\n'
                }

                return string
            }

            var t=setInterval(captureImage,100)
        </script>

        <style>
            canvas, video {
                display: none;
            }
            pre {
                font-family:"Courier New", Monospace;
                font-size: 6px;
		width: 100%;
            }
        </style>
    </head>
    <body>
        <video autoplay></video>
        <canvas></canvas>
        <pre id="output">
        </pre>
    </body>
</html>
